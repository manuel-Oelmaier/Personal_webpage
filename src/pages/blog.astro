---
import BaseLayout from '../layouts/BaseLayout.astro';
const posts = Object.values(import.meta.glob('../content/*.html', { eager: true, query: '?raw' }));

// Helper to extract title from HTML string or use filename
function getTitle(html, path) {
    const match = html.match(/<title>(.*?)<\/title>/);
    if (match) return match[1].split('|')[0].trim();
    
    // Fallback: Title case the filename
    const filename = path.split('/').pop().replace('.html', '');
    return filename.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
}

// Helper to extract a short preview/description
function getPreview(html) {
    // Strip headers and meta
    let body = html.replace(/<head>[\s\S]*?<\/head>/i, '');
    body = body.replace(/<div class="post-meta">[\s\S]*?<\/div>/i, '');
    body = body.replace(/<[^>]*>/g, ' ').trim();
    
    return body.substring(0, 160).trim() + '...';
}

// Helper to extract filename/slug
function getSlug(path) {
    return path.split('/').pop().replace('.html', '');
}

const allPosts = Object.entries(import.meta.glob('../content/*.html', { query: '?raw', eager: true })).map(([path, file]) => ({
    slug: getSlug(path),
    title: getTitle(file.default, path),
    preview: getPreview(file.default),
}));
---

<BaseLayout title="Blog | Manuel Oelmaier">
    <section class="fade-in">
        <div class="hero-text" style="min-height: 20vh; display: flex; flex-direction: column; justify-content: center; align-items: center;">
            <h1 id="name">Blog</h1>
            <p class="hero-tagline">Thoughts on AI, Software Engineering, and Life Architecture.</p>
        </div>
        
        <div class="about-me-content">
            <div class="projects-grid" style="text-align: left; margin-top: 2rem;">
                {allPosts.map((post) => (
                    <article class="card">
                        <h3 class="title">{post.title}</h3>
                        <p>{post.preview}</p>
                        <a href={`/blog/${post.slug}`} class="button-link blog-button" style="font-style: normal; width: fit-content; margin: 0; padding: 0.6rem 1.5rem;">
                            Read More
                        </a>
                    </article>
                ))}
            </div>
            
            <div style="margin-top: 4rem; text-align: center;">
                <a href="/" class="button-link blog-button" style="background-color: transparent; border: 1px solid var(--normal-TextColor); color: var(--normal-TextColor);">Back to Home</a>
            </div>
        </div>
    </section>
</BaseLayout>
