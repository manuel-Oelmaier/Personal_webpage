---
import BaseLayout from '../layouts/BaseLayout.astro';
const posts = Object.values(import.meta.glob('../content/*.html', { eager: true, query: '?raw' }));

// Helper to extract title from HTML string
function getTitle(html) {
    const match = html.match(/<title>(.*?)<\/title>/);
    return match ? match[1] : 'Untitled Post';
}

// Helper to extract a short preview/description
function getPreview(html) {
    const bodyMatch = html.match(/<body[^>]*>([\s\S]*)<\/body>/i);
    const body = bodyMatch ? bodyMatch[1] : html;
    // Strip HTML tags and get first 150 chars
    return body.replace(/<[^>]*>/g, '').trim().substring(0, 150) + '...';
}

// Helper to extract filename/slug
function getSlug(path) {
    return path.split('/').pop().replace('.html', '');
}

const allPosts = Object.entries(import.meta.glob('../content/*.html', { query: '?raw', eager: true })).map(([path, file]) => ({
    slug: getSlug(path),
    title: getTitle(file.default),
    preview: getPreview(file.default),
}));
---

<BaseLayout title="Blog | Manuel Oelmaier">
    <section class="fade-in">
        <h2>Blog</h2>
        <div class="about-me-content">
            <p>Thoughts on AI, Software Engineering, and more.</p>
            <br />
            <div class="projects-grid" style="text-align: left;">
                {allPosts.map((post) => (
                    <article class="card">
                        <h3 class="title">{post.title}</h3>
                        <p>{post.preview}</p>
                        <a href={`/blog/${post.slug}`} class="button-link blog-button" style="font-style: normal; width: fit-content; margin: 0;">
                            Read More
                        </a>
                    </article>
                ))}
            </div>
        </div>
    </section>
</BaseLayout>
